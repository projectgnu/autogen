#! /bin/sh
#  -*- Mode: Shell-script -*-
# ----------------------------------------------------------------------
# format.test --- Count format string arguments.
#
# Time-stamp:        "2002-12-14 09:57:04 bkorb"
# Author:            Bruce Korb <bkorb@gnu.org>
# Maintainer:        Bruce Korb <bkorb@gnu.org>
# Created:           7/12/2001
#            by: bkorb
#
# $Id: format.test,v 3.4 2004/10/30 20:43:56 bkorb Exp $
# ----------------------------------------------------------------------

# Common definitions
if test -z "$srcdir"; then
    srcdir=`dirname $0`
    test "${VERBOSE+set}" != set && VERBOSE=1
fi
. $srcdir/defs

# # # # # # # # # # TEMPLATE FILE # # # # # # # # #

echo creating ${testname}.tpl
cat > ${testname}.tpl <<_EOF_
[++ AutoGen5 template test ++]
[++ (dne "-d" "#  ") ++]
[++

FOR fmt "\n"

++]Fmt [++(+ 1 (for-index))++] has [++(format-arg-count (get "fmt"))
++] args: [++(c-string (get "fmt"))++][++

ENDFOR

++]
[++(hide-email "Bruce Korb" "bkorb@gnu.org")++]
_EOF_

# # # # # # # # # # DEFINITIONS FILE # # # # # # # # #

echo creating ${testname}.def
cat > ${testname}.def <<_EOF_
AutoGen definitions ${testname};
fmt = "none";
fmt = "one %s val";
fmt = "two %s (%d%%) vals";
_EOF_

# # # # # # # # # # EXPECTED OUTPUT FILE # # # # # # #
set -x
echo creating ${testname}.base
# this is the output we should expect to see
cat > ${testname}.base <<'_EOF_'
#  DO NOT EDIT THIS FILE   (format.test)
#  
#  It has been AutoGen-ed  
#  From the definitions    format.def
#  and the template file   format
Fmt 1 has 0 args: "none"
Fmt 2 has 1 args: "one %s val"
Fmt 3 has 2 args: "two %s (%d%%) vals"
<script language="JavaScript" type="text/javascript">
<!--
var one = 'm&#97;';
var two = 'i&#108;t';
document.write('<a href="' + one + two );
document.write('&#111;:&#98;&#107;&#111;&#114;&#98;&#64;&#103;&#110;&#117;&#46;&#111;&#114;&#103;');
document.write('" >Bruce Korb</a>');
//-->
</script>
_EOF_

${AGexe} ${testname}.def || failure ${AGexe} failed
cmp -s ${testname}.base ${testname}.test || \
   failure "`diff ${testname}.base ${testname}.test`"

cleanup
# end of format.test
